define(["itemHelper","globalize","apphost","connectionManager","events","emby-button"],function(itemHelper,globalize,appHost,connectionManager,events){"use strict";function updateSyncStatus(container,item){var btnSyncToggle=container.querySelector(".btnSyncToggle");btnSyncToggle&&(null!=item.SyncPercent?(btnSyncToggle.classList.add("sync-on"),btnSyncToggle.querySelector("i").innerHTML="#4285F4"):(btnSyncToggle.classList.remove("sync-on"),btnSyncToggle.querySelector("i").style.color="inherit"))}function syncToggle(options){function resetSyncStatus(){updateSyncStatus(options.container,options.item)}function onSyncLocalClick(){this.classList.contains("sync-on")?require(["confirm"],function(confirm){confirm({text:globalize.translate("sharedcomponents#ConfirmRemoveDownload"),confirmText:globalize.translate("sharedcomponents#RemoveDownload"),cancelText:globalize.translate("sharedcomponents#KeepDownload"),primary:"cancel"}).then(function(){connectionManager.getApiClient(options.item.ServerId).cancelSyncItems([options.item.Id])},resetSyncStatus)}):require(["syncDialog"],function(syncDialog){syncDialog.showMenu({items:[options.item],isLocalSync:!0,serverId:options.item.ServerId}).then(function(){events.trigger(self,"sync")},resetSyncStatus)})}var self=this;options=options||{},self.options=options;var container=options.container,user=options.user,item=options.item,html="";html+='<button type="button" is="emby-button" class="button-flat btnSyncToggle" style="margin:0;padding:.25em .5em;"><i class="md-icon">&#xE2C4;</i>',html+='<div style="margin: 0 0 0 .5em;font-weight:normal;">'+globalize.translate("sharedcomponents#Download")+"</div>",html+="</button>",itemHelper.canSync(user,item)?(appHost.supports("sync")?container.classList.remove("hide"):container.classList.add("hide"),container.innerHTML=html,container.querySelector(".btnSyncToggle").addEventListener("click",onSyncLocalClick),updateSyncStatus(container,item)):container.classList.add("hide")}return syncToggle.prototype.refresh=function(item){this.options.item=item,updateSyncStatus(this.options.container,item)},syncToggle.prototype.destroy=function(){var options=this.options;options&&(options.container.innerHTML="",this.options=null)},syncToggle});